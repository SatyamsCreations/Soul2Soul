---
import BaseLayout from '../layouts/BaseLayout.astro';
const base = import.meta.env.BASE_URL;
---

<BaseLayout title="Search — Soul2Soul" description="Search posts on Soul2Soul">
  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-bold tracking-tight text-neutral-900 dark:text-white">Search</h1>
    <p class="mt-2 text-neutral-600 dark:text-neutral-300">
      Type to search posts. The search index is generated after building the site.
    </p>

    <div id="search" class="mt-6">
      <div id="search-fallback" class="max-w-xl">
        <input type="text" aria-label="Search" placeholder="Search posts..." class="w-full rounded-md border border-neutral-300 bg-white px-4 py-3 text-neutral-900 shadow-sm focus:outline-none focus:ring-2 focus:ring-brand-600" />
        <p class="mt-2 text-sm text-neutral-500">Loading search…</p>
      </div>
    </div>

    <!-- Pagefind UI assets (served from your built site at ${base}pagefind/) -->
    <link rel="stylesheet" href={base + "pagefind/pagefind-ui.css"} />
    <script is:inline define:vars={{ base }}>
      // Bootstrap Pagefind UI; ensure visibility and correct base path for GitHub Pages.
      function setupPagefind() {
        if (!window.PagefindUI) return;
        const container = document.querySelector("#search");
        if (container) {
          // Clear any fallback content once the UI is ready
          container.innerHTML = "";
        }
        new PagefindUI({
          element: "#search",
          bundlePath: base + "pagefind/",
          resetStyles: false, // avoid heavy resets that can clash with site CSS
          autofocus: true,
          showSubResults: true,
          showImages: false,
          translations: {
            placeholder: "Search posts...",
            zero_results: "No results for [SEARCH_TERM]",
            clear_search: "Clear",
          },
        });
      }

      (function init() {
        if (window.PagefindUI) {
          setupPagefind();
          return;
        }
        // Load the UI script from the locally generated bundle (works in preview and on GitHub Pages).
        var script = document.createElement("script");
        script.src = base + "pagefind/pagefind-ui.js";
        script.onload = setupPagefind;
        document.head.appendChild(script);
      })();
    </script>
  </section>
</BaseLayout>
